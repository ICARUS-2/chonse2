<div class="componentContainer">
    <div class="boardOuterContainer" [class]="isFlipped ? 'boardOuterContainerFlipped' : ''">
        <app-captured-pieces for="b" [capturedPieces]="chessGame.piecesBlackCaptured" [advantage]="chessGame.getMaterialAdvantage()"></app-captured-pieces>
        <div class="boardContainerInner" [class]="isFlipped ? 'boardContainerInnerFlipped' : ''">
            @for( rank of chessGame.pieceState; let rankIndex = $index; track rankIndex)
            {
                <ng-container>
                    @for ( piece of rank; let fileIndex = $index; track fileIndex )
                    {
                        <app-square 
                            [coordinate]="this.COORDS[rankIndex][fileIndex]" 
                            [piece]="chessGame.pieceState[rankIndex][fileIndex]"
                            [isDark]="(rankIndex + fileIndex) % 2 == 1"
                            [showFile]="rankIndex == rank.length - 1"
                            [showRank]="fileIndex == 0"
                            [showPiece]="this.COORDS[rankIndex][fileIndex] != fromSquare"
                            [isFlipped]="isFlipped"
                            [isLegalMove]="currentLegalMoves.includes(this.COORDS[rankIndex][fileIndex])"
                            (mouseDown)="onSquareMouseDown($event)"
                            (mouseUp)="onSquareMouseUp($event)">
                        </app-square>
                    }
                </ng-container>
            }
        </div>

        <app-captured-pieces for="w" [capturedPieces]="chessGame.piecesWhiteCaptured" [advantage]="chessGame.getMaterialAdvantage()"></app-captured-pieces>
    </div>
    <div class="boardControls p-5">
        <h2>Controls</h2>
        <div class="btn btn-primary" (click)="handleFlipClicked()">↑↓</div>
        <p>{{chessGame.turn ? "White" : "Black"}} to move</p>
    </div>
    @if(currentlyHeldPiece != "")
    {
        <img class="currentlyHeldPiece"
            [src]="`piece/merida/${currentlyHeldPiece}.svg`"
            [style.left.px]="mouseX"
            [style.top.px]="mouseY">
    }
</div>
<div class="testingPurposes">
    <p>CURRENT PIECE: {{currentlyHeldPiece}}</p>
    <p>LEGAL MOVES: {{ currentLegalMoves.toString() }}</p>
</div>